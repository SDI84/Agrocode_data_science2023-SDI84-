# Модель предсказания продуктивности на основе контрольных.
[AgroCode Data Science Cup 2023](https://codenrock.com/contests/agrocode-data-science2023?#/info) — четвертый Data Science-чемпионат для студентов, который проводит АО «Россельхозбанк» и сообщество AgroCode Hub.

## Содержание
- [Цель проекта](#цель-проекта)
- [Метрика качества](#метрика-качества)
- [Технологии](#технологии)
- [Структура проекта](#структура-проекта)
- [Описание функциональности](#описание-функциональности)

## Цель проекта
Создание модели, способной предсказывать продуктивность каждой коровы в последующих месяцах, на основе данных о контрольных дойках и родословных животных.  
### Описание  
В процессах принятий решений на молочных фермах одним из важных показателей является прогноз продуктивности животных,
который необходим для отбора животных для последующего осеменения или выбраковки. 

Если модель сможет точно предсказывать продуктивность животных (удой молока), это поможет увеличить производительность
фермы и уменьшить затраты на содержание животных.

В качестве измерения удоя животных часто выступают `контрольные дойки` -- замер суточного надоя каждого животного раз в
месяц в течение всей лактации.  
### Данные

#### Родословная - predige.csv

| Колонка	  | Описание      |
| ---------- | ------------- |
| animal_id  | ID животного  |
| mother_id  | ID матери     |
| father_id  | ID отца       |


#### Контрольные дойки - train.csv

| Колонка	       | Описание                                                             | Таргет |
| ---------------- | -------------------------------------------------------------------- | ------ | 
| animal_id        | ID животного                                                         |        |
| lactation        | Номер лактации                                                       |        |
| calving_date     | Дата начала лактации                                                 |        |
| farm             | Ферма                                                                |        |
| farmgroup	       | Хозяйство (группа из ферм)                                           |        |
| birth_date       | Дата рождения животного                                              |        |
| milk_yield_1     | Контрольная дойка (удой за 1 день) в 1 месяце после начала лактации  |        |
| milk_yield_2     | Контрольная дойка (удой за 1 день) в 2 месяце после начала лактации  |        |
| milk_yield_3     | Контрольная дойка (удой за 1 день) в 3 месяце после начала лактации  | X      |
| milk_yield_4     | Контрольная дойка (удой за 1 день) в 4 месяце после начала лактации  | X      |
| milk_yield_5     | Контрольная дойка (удой за 1 день) в 5 месяце после начала лактации  | X      |
| milk_yield_6     | Контрольная дойка (удой за 1 день) в 6 месяце после начала лактации  | X      |
| milk_yield_7     | Контрольная дойка (удой за 1 день) в 7 месяце после начала лактации  | X      |
| milk_yield_8     | Контрольная дойка (удой за 1 день) в 8 месяце после начала лактации  | X      |
| milk_yield_9     | Контрольная дойка (удой за 1 день) в 9 месяце после начала лактации  | X      |
| milk_yield_10    | Контрольная дойка (удой за 1 день) в 10 месяце после начала лактации | X      |


###  Tребований к пайплайну.
1. Функция fit() – должна возвращать обученную модель. Прокешированную модель (например через pickle).

2. Функция predict(model, path_to_test_dataset) – принимает на вход объект обученной модели, возвращенной из fit() и путь к тестовому датасету, а возвращает датафрейм с прогнозами в формате, указанном в Таблице.
аблица 4. Формат датафрейма прогноза, который должен быть возвращен функцией predict()

| Колонка| Описание                                                             | Таргет |
| ------------- | ------- | ------ |
|animal_id|	ID животного	|| 
|lactation|	Номер лактации	 ||
|milk_yield_3	|Контрольная дойка (удой за 1 день) в 3 месяце после начала лактации	|X|
|milk_yield_4	|Контрольная дойка (удой за 1 день) в 4 месяце после начала лактации	|X|
|milk_yield_5	|Контрольная дойка (удой за 1 день) в 5 месяце после начала лактации	|X|
|milk_yield_6	|Контрольная дойка (удой за 1 день) в 6 месяце после начала лактации	|X|
|milk_yield_7	|Контрольная дойка (удой за 1 день) в 7 месяце после начала лактации	|X|
|milk_yield_8	|Контрольная дойка (удой за 1 день) в 8 месяце после начала лактации	|X|
|milk_yield_9	|Контрольная дойка (удой за 1 день) в 9 месяце после начала лактации	|X|
|milk_yield_10	|Контрольная дойка (удой за 1 день) в 10 месяце после начала лактации	|X|
 
3. Реализовать Dockerfile на базе python3.10, который корректно собирается и позволяет корректно исполнить внутри себя функции fit() и predict(). Все зависимости должны быть указаны в requirements.txt. 

## Метрика качества.

Метрикой качества является RMSE между данными к контрольным дойкам с 3-ей по 10-ю (для тех контрольных доек, где данные
известны) и их прогнозом.


## Технологии
- `Pandas`, `NumPy`, `LightGBM`, `Optuna`, `Pickele`
- `GitLab`, `Docker`

## Структура проекта
- `Agrocode_data_science2023.ipynb`: Файл рабочего блокнота исследования моделей.  
- `baseline.py`: Файл, содержащий функции: 
  - fit() – возвращает обученную модель(покешированную через pickle модель). 
  - predict(model, path_to_test_dataset) – принимает на вход объект обученной модели, возвращенной из fit() и путь к тестовому датасету, а возвращает датафрейм с прогнозами.  
- `test1.ipynb` : Файл рабочего блокнота содержащий прообраз `baseline.py` и создание кешированной через pickle модели.  
- `requirements.txt`: Файл с перечнем зависимостей для установки необходимых библиотек.  
- `Dockerfile`: Файл содержащий инструкции по созданию образа Docker.  

## Описание функциональности
Этот проект предоставляет функциональность для предсказания продуктивности 8ми удоев, на основании родословной и 2х контрольных дойках. Предсказание использует метод LGBMRegressor.
### Результат на privat данных
RMSE = 7.607









